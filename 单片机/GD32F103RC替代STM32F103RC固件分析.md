# GD32F103RC替代STM32F103RC固件分析

### 问题

>  Q：是否有必要采用替代方案？
>
>  A：目前了解到ST芯片买不到，GD的芯片需要3-4个月的交期。具体需要咨询公司采购。

### 提供的官方库

+ STM32F103

  STM32CubeMX生成的HAL库(集成度高)

  STM32CubeMX生成的LL库(类似以前的标准库)

  标准库stdlib

+ GD32F103

  官方提供的标准库

### 目前替代情况

固件本身有做层次分离，但是HAL层的接口太粗糙，移植起来效率还可以，但是兼容性不够完善。目前的代码无法将两个BSP整合到一个HAL接口上，并且部分外设没有分离，比如RCC配置，片内Flash读写，需要进一步开发。

**高功率驱动板固件**的移植工作目前基本完成(剩Bootloader、PWM生成未做，不影响老化)，正在进行长时间老化测试。

### 风险

根据网上所说GD的抗干扰能力要比ST差。[博客原文](https://blog.csdn.net/cxw312864660/article/details/107645867)

### 解决方案

1. 需要移植的固件分为GD版和ST版两个版本同步维护更新

   优势：前期移植速度快

   劣势：固件双版本，后期不方便维护

   ![image-20210323170854633](D:\gitRepo_my\cheney-du.github.io\单片机\image-20210323170854633.png)

   ​																												图1 方案1双固件框架

2. 我司自己研发统一的HAL层和不同平台的BSP

   优势：固件单版本，方便维护。自己制定规则，方便移植

   劣势：开发周期长，需要时间进行稳定性测试（开发1个月左右，移植稳定性测试耗时根据移植次数决定）

3. 采用第三方HAL层及其提供的BSP（基本上都是带OS的）

   优势：固件单版本，方便维护。开发周期缩短，仅需要进行移植Application Layer程序

   劣势：根据第三方框架，应用逻辑可能需要做相应改动。学习成本。

   备胎框架：rtthread(OS)，BabyOS(No OS)

   ![image-20210323171259092](D:\gitRepo_my\cheney-du.github.io\单片机\image-20210323171259092.png)

   ​																												图2 方案2、3单固件框架

   ### 结论

   > 如果采用替代方，以我司的高标准肯定是选择采用HAL库+BSP的形式，但选择方案2还是方案3，还需要进一步讨论

